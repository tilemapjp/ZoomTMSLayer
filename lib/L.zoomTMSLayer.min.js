/* Copyright (c) 2012 OHTSUKA Ko-hei */L.ZoomTMSLayer=L.TileLayer.extend({options:{errorTileUrl:"data:image/png;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",tileMaxZoom:null,name:"",alt:"",serviceVersion:"1.0.0",layername:null,type:"png",tms:!0},initialize:function(e){if(typeof e.url=="undefined")throw new Error("Url property is required.");if(typeof e.layername=="undefined")throw new Error("Layername property is required.");if(typeof e.tileMaxZoom=="undefined")throw new Error("TileMaxZoom property is required.");e=L.Util.setOptions(this,e);var t="{z}/{x}/{y}."+e.type;e.layername!=""&&(t=e.layername+"/"+t),e.serviceVersion!=""&&(t=e.serviceVersion+"/"+t),L.TileLayer.prototype.initialize.call(this,e.url+t,e)},_createTileProto:function(){var e=this._tileImg=L.DomUtil.create("div","leaflet-tile"),t=this.options.tileSize;e.style.width=t+"px",e.style.height=t+"px";var n=e.base=L.DomUtil.create("div","",e);n.style.width=t+"px",n.style.height=t+"px";var r=e.img=L.DomUtil.create("img","",n);r.style.width=t+"px",r.style.height=t+"px",r.style.position="absolute",r.style.filter="inherit",r.galleryimg="no"},_createTile:function(){var e=this._tileImg.cloneNode(!0);return e.base=e.getElementsByTagName("div")[0],e.img=e.getElementsByTagName("img")[0],e.onselectstart=e.onmousemove=L.Util.falseFn,e},_loadTile:function(e,t){var n=this.options,r=this._map.getZoom()+n.zoomOffset-this._getZoomForUrl();e._layer=e.img._layer=this,e.img.onload=this._tileOnLoad,e.img.onerror=this._tileOnError;var i;if(r>0){var s=Math.pow(2,r),o=n.tileSize*(s-1)/(s*2),u=n.tileSize/s,a=t.x%s,f=o-a*u,l=t.y%s,c=o-l*u;t.x=Math.floor(t.x/s),t.y=Math.floor(t.y/s);var h="scale("+s+","+s+") translate("+f+"px,"+c+"px)";e.base.style.transform=h,e.base.style.msTransform=h,e.base.style.webkitTransform=h,e.base.style.MozTransform=h,e.base.style.OTransform=h,e.img.style.clip="rect("+l*u+"px,"+(a+1)*u+"px,"+(l+1)*u+"px,"+a*u+"px)",i=this.getTileUrl(t)}else i=this.getTileUrl(t);e.img.src=e.src=i},_tileShouldBeLoaded:function(e){if(e.x+":"+e.y in this._tiles)return!1;if(!this.options.continuousWorld){var t=this._getWrapTileNum(),n=this._map.getZoom()-this._getZoomForUrl();t*=Math.pow(2,n);if(this.options.noWrap&&(e.x<0||e.x>=t)||e.y<0||e.y>=t)return!1}return!0},_getZoomForUrl:function(){var e=this.options,t=this._map.getZoom()+e.zoomOffset;return t>e.tileMaxZoom&&(t=e.tileMaxZoom),e.zoomReverse&&(t=e.maxZoom-t),t},_tileOnLoad:function(e){var t=this.parentNode.parentNode,n=t._layer;t.className+=" leaflet-tile-loaded",n.fire("tileload",{tile:t,url:this.src}),n._tilesToLoad--,n._tilesToLoad||n.fire("load")}}),L.zoomTMSLayer=function(e){return new L.ZoomTMSLayer(e)};
